import{a9 as E,aa as X,r as K,B as J,R as Y,q as M,D as x,m as b,U as j,o as p,c as y,G as $,H as U,h as i,x as T,y as I,t as v,j as k,b as u,w as f,E as Q,$ as W,T as Z,v as ee,d as te,a as ae,Y as ne,f as se,a3 as R,e as d,s as P,ab as re}from"./index-D8z3C0De.js";import{s as ie,u as oe}from"./index.esm-7sGathEJ.js";import{A as ce}from"./AppLayout-CbqrBV_e.js";import{s as D}from"./overlayeventbus.esm-CbpWPw93.js";import{s as C,R as g,a as B,A as H}from"./index-BZWFC1cE.js";import{s as F,a as le}from"./tabpanel.esm-CD_LGUUc.js";import{s as de}from"./index.esm-BLJojiT8.js";const ue={async getResults(t){return(await E.get(`/api/v1/analysis/results/${t}`)).data},async analyzeTrends(t){return(await E.post("/api/v1/analysis/trends",t)).data},async analyzeRegional(t){return(await E.post("/api/v1/analysis/regional",t)).data},async analyzeCompetitive(t){return(await E.post("/api/v1/analysis/competitive",t)).data}},pe=X("analysis",()=>{const t=K([]),e=K(!1),a=K(null);async function n(s){try{return e.value=!0,a.value=null,t.value=await ue.getResults(s),t.value}catch(r){throw a.value=r.response?.data?.detail||"Ошибка загрузки результатов",r}finally{e.value=!1}}function c(){t.value=[]}return{results:t,loading:e,error:a,fetchResults:n,clearResults:c}});var he={root:"p-accordion p-component",tab:{root:function(e){var a=e.instance,n=e.index;return["p-accordion-tab",{"p-accordion-tab-active":a.isTabActive(n)}]},header:function(e){var a=e.instance,n=e.tab,c=e.index;return["p-accordion-header",{"p-highlight":a.isTabActive(c),"p-disabled":a.getTabProp(n,"disabled")}]},headerAction:"p-accordion-header-link p-accordion-header-action",headerIcon:"p-accordion-toggle-icon",headerTitle:"p-accordion-header-text",toggleableContent:"p-toggleable-content",content:"p-accordion-content"}},fe=J.extend({name:"accordion",classes:he}),be={name:"BaseAccordion",extends:M,props:{multiple:{type:Boolean,default:!1},activeIndex:{type:[Number,Array],default:null},lazy:{type:Boolean,default:!1},expandIcon:{type:String,default:void 0},collapseIcon:{type:String,default:void 0},tabindex:{type:Number,default:0},selectOnFocus:{type:Boolean,default:!1}},style:fe,provide:function(){return{$parentInstance:this}}},z={name:"Accordion",extends:be,inheritAttrs:!1,emits:["update:activeIndex","tab-open","tab-close","tab-click"],data:function(){return{id:this.$attrs.id,d_activeIndex:this.activeIndex}},watch:{"$attrs.id":function(e){this.id=e||j()},activeIndex:function(e){this.d_activeIndex=e}},mounted:function(){this.id=this.id||j()},methods:{isAccordionTab:function(e){return e.type.name==="AccordionTab"},isTabActive:function(e){return this.multiple?this.d_activeIndex&&this.d_activeIndex.includes(e):this.d_activeIndex===e},getTabProp:function(e,a){return e.props?e.props[a]:void 0},getKey:function(e,a){return this.getTabProp(e,"header")||a},getTabHeaderActionId:function(e){return"".concat(this.id,"_").concat(e,"_header_action")},getTabContentId:function(e){return"".concat(this.id,"_").concat(e,"_content")},getTabPT:function(e,a,n){var c=this.tabs.length,s={props:e.props||{},parent:{instance:this,props:this.$props,state:this.$data},context:{index:n,count:c,first:n===0,last:n===c-1,active:this.isTabActive(n)}};return b(this.ptm("tab.".concat(a),{tab:s}),this.ptm("accordiontab.".concat(a),{accordiontab:s}),this.ptm("accordiontab.".concat(a),s),this.ptmo(this.getTabProp(e,"pt"),a,s))},onTabClick:function(e,a,n){this.changeActiveIndex(e,a,n),this.$emit("tab-click",{originalEvent:e,index:n})},onTabKeyDown:function(e,a,n){switch(e.code){case"ArrowDown":this.onTabArrowDownKey(e);break;case"ArrowUp":this.onTabArrowUpKey(e);break;case"Home":this.onTabHomeKey(e);break;case"End":this.onTabEndKey(e);break;case"Enter":case"NumpadEnter":case"Space":this.onTabEnterKey(e,a,n);break}},onTabArrowDownKey:function(e){var a=this.findNextHeaderAction(e.target.parentElement.parentElement);a?this.changeFocusedTab(e,a):this.onTabHomeKey(e),e.preventDefault()},onTabArrowUpKey:function(e){var a=this.findPrevHeaderAction(e.target.parentElement.parentElement);a?this.changeFocusedTab(e,a):this.onTabEndKey(e),e.preventDefault()},onTabHomeKey:function(e){var a=this.findFirstHeaderAction();this.changeFocusedTab(e,a),e.preventDefault()},onTabEndKey:function(e){var a=this.findLastHeaderAction();this.changeFocusedTab(e,a),e.preventDefault()},onTabEnterKey:function(e,a,n){this.changeActiveIndex(e,a,n),e.preventDefault()},findNextHeaderAction:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=a?e:e.nextElementSibling,c=x.findSingle(n,'[data-pc-section="header"]');return c?x.getAttribute(c,"data-p-disabled")?this.findNextHeaderAction(c.parentElement):x.findSingle(c,'[data-pc-section="headeraction"]'):null},findPrevHeaderAction:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=a?e:e.previousElementSibling,c=x.findSingle(n,'[data-pc-section="header"]');return c?x.getAttribute(c,"data-p-disabled")?this.findPrevHeaderAction(c.parentElement):x.findSingle(c,'[data-pc-section="headeraction"]'):null},findFirstHeaderAction:function(){return this.findNextHeaderAction(this.$el.firstElementChild,!0)},findLastHeaderAction:function(){return this.findPrevHeaderAction(this.$el.lastElementChild,!0)},changeActiveIndex:function(e,a,n){if(!this.getTabProp(a,"disabled")){var c=this.isTabActive(n),s=c?"tab-close":"tab-open";this.multiple?c?this.d_activeIndex=this.d_activeIndex.filter(function(r){return r!==n}):this.d_activeIndex?this.d_activeIndex.push(n):this.d_activeIndex=[n]:this.d_activeIndex=this.d_activeIndex===n?null:n,this.$emit("update:activeIndex",this.d_activeIndex),this.$emit(s,{originalEvent:e,index:n})}},changeFocusedTab:function(e,a){if(a&&(x.focus(a),this.selectOnFocus)){var n=parseInt(a.parentElement.parentElement.dataset.pcIndex,10),c=this.tabs[n];this.changeActiveIndex(e,c,n)}}},computed:{tabs:function(){var e=this;return this.$slots.default().reduce(function(a,n){return e.isAccordionTab(n)?a.push(n):n.children&&n.children instanceof Array&&n.children.forEach(function(c){e.isAccordionTab(c)&&a.push(c)}),a},[])}},components:{ChevronDownIcon:ie,ChevronRightIcon:de},directives:{ripple:Y}};function w(t){"@babel/helpers - typeof";return w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(t)}function L(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),a.push.apply(a,n)}return a}function A(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?L(Object(a),!0).forEach(function(n){ve(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):L(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function ve(t,e,a){return e=ye(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function ye(t){var e=me(t,"string");return w(e)=="symbol"?e:String(e)}function me(t,e){if(w(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var n=a.call(t,e);if(w(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var ge=["data-pc-index","data-p-active"],Te=["data-p-highlight","data-p-disabled"],xe=["id","tabindex","aria-disabled","aria-expanded","aria-controls","onClick","onKeydown"],Ae=["id","aria-labelledby"];function _e(t,e,a,n,c,s){return p(),y("div",b({class:t.cx("root")},t.ptmi("root")),[(p(!0),y($,null,U(s.tabs,function(r,o){return p(),y("div",b({key:s.getKey(r,o),class:t.cx("tab.root",{tab:r,index:o})},s.getTabPT(r,"root",o),{"data-pc-name":"accordiontab","data-pc-index":o,"data-p-active":s.isTabActive(o)}),[i("div",b({style:s.getTabProp(r,"headerStyle"),class:[t.cx("tab.header",{tab:r,index:o}),s.getTabProp(r,"headerClass")]},A(A({},s.getTabProp(r,"headerProps")),s.getTabPT(r,"header",o)),{"data-p-highlight":s.isTabActive(o),"data-p-disabled":s.getTabProp(r,"disabled")}),[i("a",b({id:s.getTabHeaderActionId(o),class:t.cx("tab.headerAction"),tabindex:s.getTabProp(r,"disabled")?-1:t.tabindex,role:"button","aria-disabled":s.getTabProp(r,"disabled"),"aria-expanded":s.isTabActive(o),"aria-controls":s.getTabContentId(o),onClick:function(_){return s.onTabClick(_,r,o)},onKeydown:function(_){return s.onTabKeyDown(_,r,o)}},A(A({},s.getTabProp(r,"headeractionprops")),s.getTabPT(r,"headeraction",o))),[r.children&&r.children.headericon?(p(),T(I(r.children.headericon),{key:0,isTabActive:s.isTabActive(o),active:s.isTabActive(o),index:o},null,8,["isTabActive","active","index"])):s.isTabActive(o)?(p(),T(I(t.$slots.collapseicon?t.$slots.collapseicon:t.collapseIcon?"span":"ChevronDownIcon"),b({key:1,class:[t.cx("tab.headerIcon"),t.collapseIcon],"aria-hidden":"true"},s.getTabPT(r,"headericon",o)),null,16,["class"])):(p(),T(I(t.$slots.expandicon?t.$slots.expandicon:t.expandIcon?"span":"ChevronRightIcon"),b({key:2,class:[t.cx("tab.headerIcon"),t.expandIcon],"aria-hidden":"true"},s.getTabPT(r,"headericon",o)),null,16,["class"])),r.props&&r.props.header?(p(),y("span",b({key:3,class:t.cx("tab.headerTitle")},s.getTabPT(r,"headertitle",o)),v(r.props.header),17)):k("",!0),r.children&&r.children.header?(p(),T(I(r.children.header),{key:4})):k("",!0)],16,xe)],16,Te),u(Z,b({name:"p-toggleable-content"},s.getTabPT(r,"transition",o)),{default:f(function(){return[!t.lazy||s.isTabActive(o)?Q((p(),y("div",b({key:0,id:s.getTabContentId(o),style:s.getTabProp(r,"contentStyle"),class:[t.cx("tab.toggleableContent"),s.getTabProp(r,"contentClass")],role:"region","aria-labelledby":s.getTabHeaderActionId(o)},A(A({},s.getTabProp(r,"contentProps")),s.getTabPT(r,"toggleablecontent",o))),[i("div",b({class:t.cx("tab.content")},s.getTabPT(r,"content",o)),[(p(),T(I(r)))],16)],16,Ae)),[[W,t.lazy?!0:s.isTabActive(o)]]):k("",!0)]}),_:2},1040)],16,ge)}),128))],16)}z.render=_e;var Ie={},Pe={name:"BaseAccordionTab",extends:M,props:{header:null,headerStyle:null,headerClass:null,headerProps:null,headerActionProps:null,contentStyle:null,contentClass:null,contentProps:null,disabled:Boolean},style:Ie,provide:function(){return{$parentInstance:this}}},G={name:"AccordionTab",extends:Pe,inheritAttrs:!1};function we(t,e,a,n,c,s){return ee(t.$slots,"default")}G.render=we;const Se={class:"p-4"},Ee={key:0,class:"flex flex-column gap-4"},De={class:"flex justify-content-between align-items-start"},Ce={class:"flex-1"},He={class:"text-3xl font-bold mb-2"},ke={class:"flex gap-2 mb-3"},Oe={class:"text-600"},Ke={class:"flex gap-2"},Re={class:"flex flex-column gap-3"},Fe={class:"text-600"},Ne={class:"flex gap-4"},je={class:"ml-2"},Be={class:"ml-2"},Le={class:"text-center py-5"},Me={key:1,class:"flex flex-column gap-3"},$e={class:"flex flex-column gap-3"},Ue={class:"flex justify-content-between align-items-center"},ze={class:"text-sm text-600"},Ge={class:"text-600"},Ve={key:0},qe={class:"font-semibold"},Xe={class:"surface-100 p-3 border-round overflow-auto"},Je={class:"text-center py-5"},Ye={class:"flex gap-2 justify-content-center"},Qe={key:1,class:"flex flex-column gap-3"},rt=te({__name:"ResearchDetailView",setup(t){const e=re(),a=se(),n=oe(),c=pe(),s=ae(),r=R(()=>e.params.id);ne(async()=>{try{await n.fetchById(r.value),await c.fetchResults(r.value)}catch{s.add({severity:"error",summary:"Ошибка",detail:"Не удалось загрузить исследование",life:5e3}),a.push({name:"dashboard"})}});const o=R(()=>n.currentResearch),S=R(()=>c.results),_=h=>({[g.DRAFT]:"secondary",[g.IN_PROGRESS]:"info",[g.COMPLETED]:"success",[g.FAILED]:"danger"})[h]||"secondary",V=h=>({[g.DRAFT]:"Черновик",[g.IN_PROGRESS]:"В процессе",[g.COMPLETED]:"Завершено",[g.FAILED]:"Ошибка"})[h]||h,q=h=>({[H.TREND]:"Анализ трендов",[H.REGIONAL]:"Региональный анализ",[H.COMPETITIVE]:"Конкурентный анализ",[H.MARKET]:"Рыночный анализ"})[h]||h,N=async()=>{try{await n.startAnalysis(r.value),s.add({severity:"info",summary:"Запущено",detail:"Анализ запущен, это может занять несколько минут",life:5e3})}catch{s.add({severity:"error",summary:"Ошибка",detail:"Не удалось запустить анализ",life:5e3})}},O=h=>new Date(h).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(h,l)=>(p(),T(ce,null,{default:f(()=>[i("div",Se,[o.value?(p(),y("div",Ee,[u(d(D),null,{content:f(()=>[i("div",De,[i("div",Ce,[i("h1",He,v(o.value.title),1),i("div",ke,[u(d(C),{value:V(o.value.status),severity:_(o.value.status)},null,8,["value","severity"]),u(d(C),{value:o.value.industry,icon:"pi pi-tag",severity:"info"},null,8,["value"]),u(d(C),{value:o.value.region,icon:"pi pi-map-marker",severity:"success"},null,8,["value"])]),i("p",Oe,v(o.value.description),1)]),i("div",Ke,[u(d(P),{label:"Запустить анализ",icon:"pi pi-play",onClick:N,disabled:o.value.status===d(g).IN_PROGRESS},null,8,["disabled"]),u(d(P),{icon:"pi pi-arrow-left",outlined:"",onClick:l[0]||(l[0]=m=>d(a).push({name:"dashboard"}))})])])]),_:1}),u(d(le),null,{default:f(()=>[u(d(F),{header:"Информация"},{default:f(()=>[u(d(D),null,{content:f(()=>[i("div",Re,[i("div",null,[l[1]||(l[1]=i("h3",{class:"text-lg font-semibold mb-2"},"Описание продукта/услуги",-1)),i("p",Fe,v(o.value.product_description),1)]),i("div",Ne,[i("div",null,[l[2]||(l[2]=i("span",{class:"text-600"},"Создано:",-1)),i("span",je,v(O(o.value.created_at)),1)]),i("div",null,[l[3]||(l[3]=i("span",{class:"text-600"},"Обновлено:",-1)),i("span",Be,v(O(o.value.updated_at)),1)])])])]),_:1})]),_:1}),u(d(F),{header:"Результаты анализа"},{default:f(()=>[S.value.length===0?(p(),T(d(D),{key:0},{content:f(()=>[i("div",Le,[l[4]||(l[4]=i("i",{class:"pi pi-chart-line text-5xl text-400 mb-3"},null,-1)),l[5]||(l[5]=i("p",{class:"text-xl mb-3"},"Результаты анализа пока отсутствуют",-1)),l[6]||(l[6]=i("p",{class:"text-600 mb-4"},"Запустите анализ, чтобы получить результаты",-1)),u(d(P),{label:"Запустить анализ",icon:"pi pi-play",onClick:N})])]),_:1})):(p(),y("div",Me,[u(d(z),{multiple:!0},{default:f(()=>[(p(!0),y($,null,U(S.value,m=>(p(),T(d(G),{key:m.id,header:m.title},{default:f(()=>[i("div",$e,[i("div",Ue,[u(d(C),{value:q(m.analysis_type)},null,8,["value"]),i("span",ze,v(O(m.created_at)),1)]),i("div",null,[l[7]||(l[7]=i("h4",{class:"mb-2"},"Резюме",-1)),i("p",Ge,v(m.summary),1)]),m.confidence_score?(p(),y("div",Ve,[l[8]||(l[8]=i("span",{class:"text-600"},"Уверенность: ",-1)),i("span",qe,v(Math.round(m.confidence_score*100))+"% ",1)])):k("",!0),i("div",null,[l[9]||(l[9]=i("h4",{class:"mb-2"},"Детальные результаты",-1)),i("pre",Xe,v(JSON.stringify(m.results,null,2)),1)])])]),_:2},1032,["header"]))),128))]),_:1})]))]),_:1}),u(d(F),{header:"Экспорт"},{default:f(()=>[u(d(D),null,{content:f(()=>[i("div",Je,[l[10]||(l[10]=i("i",{class:"pi pi-file-export text-5xl text-400 mb-3"},null,-1)),l[11]||(l[11]=i("p",{class:"text-xl mb-3"},"Экспорт отчетов",-1)),l[12]||(l[12]=i("p",{class:"text-600 mb-4"}," Функция экспорта в PDF и DOCX будет доступна в следующей фазе разработки ",-1)),i("div",Ye,[u(d(P),{label:"PDF",icon:"pi pi-file-pdf",disabled:""}),u(d(P),{label:"DOCX",icon:"pi pi-file-word",disabled:""})])])]),_:1})]),_:1})]),_:1})])):(p(),y("div",Qe,[u(d(B),{height:"10rem"}),u(d(B),{height:"20rem"})]))])]),_:1}))}});export{rt as default};
